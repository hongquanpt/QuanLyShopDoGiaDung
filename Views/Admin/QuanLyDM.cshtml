@{
    ViewBag.Title = "QuanLyDM";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    var dstk = (List<ShopBanDoGiaDung.Models.Danhmucsanpham>)ViewBag.ds;
}



    <!-- Topbar -->
    <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

        <!-- Sidebar Toggle (Topbar) -->
        <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
            <i class="fa fa-bars"></i>
        </button>


        <!-- Topbar Navbar -->
        <ul class="navbar-nav ml-auto">

            <!-- Nav Item - Search Dropdown (Visible Only XS) -->
            <li class="nav-item dropdown no-arrow d-sm-none">
                <a class="nav-link dropdown-toggle" href="#" id="searchDropdown" role="button"
                   data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-search fa-fw"></i>
                </a>
                <!-- Dropdown - Messages -->
                <div class="dropdown-menu dropdown-menu-right p-3 shadow animated--grow-in"
                     aria-labelledby="searchDropdown">
                    <form class="form-inline mr-auto w-100 navbar-search">
                        <div class="input-group">
                            <input type="text" class="form-control bg-light border-0 small"
                                   placeholder="Search for..." aria-label="Search"
                                   aria-describedby="basic-addon2">
                            <div class="input-group-append">
                                <button class="btn btn-primary" type="button">
                                    <i class="fas fa-search fa-sm"></i>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </li>


            <!-- Nav Item - User Information -->
            <li class="nav-item dropdown no-arrow">
                <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                   data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span class="mr-2 d-none d-lg-inline text-gray-600 small">Xin chào, Admin</span>
                    <img class="img-profile rounded-circle"
                         src="~/Admin/img/undraw_profile.svg">
                </a>
                <!-- Dropdown - User Information -->
                <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                     aria-labelledby="userDropdown">

                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#" onclick="handleLogout()" @*data-toggle="modal" data-target="#logoutModal*@>
                        <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                        Logout
                    </a>
                    <script>
                        const handleLogout = () => {
                            Swal.fire({
                                title: 'Bạn có chắc chắn muốn đăng xuất?',
                                showCancelButton: true,
                                confirmButtonText: 'Đăng xuất',
                                denyButtonText: `Hủy`,
                            }).then((result) => {
                                /* Read more about isConfirmed, isDenied below */
                                if (result.isConfirmed) {
                                    window.location = '@Url.Action("Logout","Home")'
                                }
                            })
                        }
                    </script>
                </div>
            </li>

        </ul>

    </nav>
    <!-- End of Topbar -->
    <!-- Begin Page Content -->
    <div class="container-fluid">
        <div class="table-responsive">
            <div class="table-wrapper">
                <div class="table-title">
                    <div class="row">
                        <div class="col-sm-5">
                            <h2 style="font-weight: bold">Quản lý danh mục</h2>
                        </div>
                        <div class="col-sm-7">
                            <a href="#" class="btn btn-primary" style="background-color: #ffb836;"><i class="material-icons" style="color: white;">&#xE147;</i> <span style="color: white;" data-toggle="modal" data-target="#them">Thêm mới</span></a>
                            @*<a href="#" class="btn btn-secondary" style="display: none;"><i class="material-icons">&#xE24D;</i> <span>Xuất Excel</span></a>*@
                        </div>
                    </div>
                </div>
                <table class="table table-striped table-hover" style="text-align:center" id="showtable">
                    <!-- <h3>Không tìm thấy kết quả</h3> -->
                    <thead>
                        <tr>
                            <th>Mã danh mục</th>
                            <th>Tên danh mục</th>
                            <th>Hành động</th>

                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in dstk)
                        {
                            <tr>
                                <td>@item.MaDanhMuc</td>
                                <td>@item.TenDanhMuc</td>

                                <td>
                                    <a href="#" class="settings" title="Settings" data-toggle="modal" id="viewbtn" data-target="#sua"><i class="material-icons">&#xE8B8;</i></a>
                                    <a href="#" class="delete" title="Delete" data-toggle="modal" onclick="XoaDanhMuc(@item.MaDanhMuc)"><i class="material-icons">&#xE5C9;</i></a>
                                </td>
                            </tr>
                            <script>
                                function XoaDanhMuc(ma) {
                                    var mahang = parseInt(ma);
                                    Swal.fire({
                                        title: 'Bạn có chắc chắn muốn xóa?',
                                        showCancelButton: true,
                                        confirmButtonText: 'Xóa',
                                        denyButtonText: `Hủy`,
                                    }).then((result) => {
                                        /* Read more about isConfirmed, isDenied below */
                                        if (result.isConfirmed) {
                                            $.ajax({
                                                url: '/Admin/XoaDanhMuc',
                                                data: {
                                                    mahang: mahang
                                                },
                                                type: 'POST',
                                                dataType: 'json',
                                                success: function (res) {
                                                    if (res.status == true) {

                                                        Swal.fire({
                                                            position: 'center',
                                                            icon: 'success',
                                                            title: 'Đã xóa',
                                                            showConfirmButton: false,
                                                            timer: 100
                                                        })
                                                        window.location = '@Url.Action("QuanLyDM","Admin")'

                                                    }
                                                }

                                            });

                                        }
                                    })
                                }
                            </script>


                        }
                </table>
                <div class="modal fade" id="them" role="dialog">
                    <div class="modal-dialog modal-dialog-centered">
                        <!-- Modal content-->
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Thêm danh mục sản phẩm</h4>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                            </div>
                            <form id="frmThemDanhMuc">
                                <div class="modal-body">
                                    <div class="form-group">
                                        <label for="usr">Tên hãng</label>
                                        <input type="text" placeholder="Nhập tên danh mục tại đây" class="form-control" id="tendanhmuc" name="TenDanhMuc">
                                    </div>

                                </div>
                            </form>

                            <div class="modal-footer">
                                <a type="button" class="btn btn-primary" href="#" data-dismiss="modal" onclick="ThemDanhMuc()">Thêm hãng</a>
                                <button type="button" class="btn btn-default" data-dismiss="modal" @*data-toggle="modal" data-target="#error"*@>Hủy bỏ</button>
                                <script>
                                    function ThemDanhMuc() {
                                        $('#frmThemDanhMuc').validate({
                                            rules: {
                                                TenDanhMuc: "required"
                                            },
                                            messages: {

                                                TenHang: {
                                                    required: "Bạn chưa nhập tên danh mục",
                                                },
                                            }
                                        });
                                        var valid = $('#frmThemDanhMuc').valid();
                                        if (valid) {
                                            var tendanhmuc = $('#tendanhmuc').val().toString();
                                            $.ajax({
                                                url: '/Admin/ThemDanhMuc',
                                                data: {
                                                    tendanhmuc: tendanhmuc
                                                },
                                                type: 'POST',
                                                dataType: 'json',
                                                success: function (res) {
                                                    if (res.status == true) {

                                                        Swal.fire({
                                                            position: 'center',
                                                            icon: 'success',
                                                            title: 'Thêm thành công',
                                                            showConfirmButton: false,
                                                            timer: 100
                                                        })
                                                        window.location = '@Url.Action("QuanLyDM","Admin")'
                                                    }
                                                }
                                            });

                                        }
                                    }
                                </script>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="modal fade" id="sua" role="dialog">
                    <div class="modal-dialog modal-dialog-centered">
                    </div>
                    <script>
                        $("#showtable").on("click", "#viewbtn", function () {
                            var id = $(this).closest("tr").find("td").eq(0).html();
                            $.ajax({
                                url: "@Url.Action("SuaTTDanhMuc", "Admin")",
                                data: { id: id },
                                success: function (data) {
                                    $("#sua .modal-dialog").html(data);
                                    /* $("#showmodal").modal('show')*/
                                }
                            });
                        });
                    </script>
                    <div class="modal fade" id="xoa" role="dialog">
                        <div class="modal-dialog modal-dialog-centered">
                            <!-- Modal content-->
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="modal-title">Thông báo</h4>
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                </div>
                                <div class="modal-body">
                                    <h5>Bạn có chắc chắn muốn xóa không?</h5>
                                </div>
                                <div class="modal-footer">
                                    <a type="button" class="btn btn-primary" href="#" data-dismiss="modal" onclick="alert('Xóa khách hàng thành công!')">Đồng ý</a>
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Hủy bỏ</button>

                                </div>
                            </div>

                        </div>
                    </div>

                </div>
            </div>
        </div>
        <!-- /.container-fluid -->

    </div>



